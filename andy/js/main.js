function getUrlVars(){for(var a,e=[],t=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=0;n<t.length;n++)a=t[n].split("="),e.push(a[0]),e[a[0]]=a[1];return e}$(document).ready(function(){function a(){if(L.contactload+=1,!(L.contactload<2)){for(var a=0;a<L.learndata.length;a++)if("contactus"==L.learndata[a].collectname)for(var t=0;t<L.learndata[a].length;t++)$(".paper_addr").append('<li><div class="posttitle">'+L.learndata[a][t].addr+'</div><div class="btn" item="'+t+'" num="'+a+'"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>');else if("emailbox"==L.learndata[a].collectname)for(var t=0;t<L.learndata[a].length;t++)$(".paper_mail").append('<li><div class="contact_name">'+L.learndata[a][t].username+'</div><div class="contact_phone">'+L.learndata[a][t].userphone+'</div><div class="contact_email">'+L.learndata[a][t].useremail+'</div><div class="contact_des">'+L.learndata[a][t].userword+'</div><div class="contact_date">'+L.learndata[a][t].postdate+'</div><div class="btn" item="'+t+'" num="'+a+'"><div title="刪除" class="delbtn"></div></div></li>');e()}}function e(){$(".paper_addr .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),_(!1,$(this).parent().attr("item"),$(this).parent().attr("num"))):alert("地址是必要資料，無法刪除。")}),$(".paper_addr .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),x($(this).parent().attr("item"),$(this).parent().attr("num"))):($(this).addClass("on"),_(!0,$(this).parent().attr("item")))}),$(".paper_mail .delbtn").click(function(){var a=confirm("確定刪除留言嗎?");1==a&&P($(this).parent().attr("item"),$(this).parent().attr("num"))}),$(".menuin a").removeClass("on").eq(6).addClass("on"),N(!1)}function t(){console.log(L.newPaperdata);for(var a=0;a<L.newPaperdata.length;a++)$(".paper").append('<li><div class="postphoto"><img src="'+L.newPaperdata[a].pic+'"></div><div class="posttitle"><a href="'+L.newPaperdata[a].link+'" target="_blank">'+L.newPaperdata[a].link+'</a></div><div class="btn" item="'+a+'"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>');n()}function n(){$(".paper .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),_(!1,$(this).parent().attr("item"))):P($(this).parent().attr("item"))}),$(".paper .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),x($(this).parent().attr("item"))):($(this).addClass("on"),_(!0,$(this).parent().attr("item")))}),$(".menuin a").removeClass("on").eq(5).addClass("on"),N(!1)}function s(){return L.insertdata={title:$(".addgame .posttitle").val().replace(/\n\r?/g,"<br>"),list:[]},L.insertdata.title?(N(!0),void $.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/awards"+L.nowpage+"?apiKey="+L.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(L.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})):void alert(L.creatUsererrortxt)}function r(a){$(".gameboxout").html("");for(i in L.newPaperdata){$(".gameboxout").append('<div class="gamebox" gamenum="'+i+'"><div class="t awardspapertitle"><div class="posttitle">比賽名稱</div><div class="btn">功能</div></div><ul class="paper awardspapertitle" num="0"><li><div class="posttitle">'+L.newPaperdata[i].title+'</div><div class="btn"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li></ul><div class="new awardspapertitle"><div class="databox"><div class="lt"><input type="text" placeholder="請輸入姓名" class="username"><input type="text" placeholder="請輸入獎項" class="userdes"></div></div><button class="gobtn" gamenum="'+i+'">確定新增</button></div><div class="t"><div class="posttitle">姓名</div><div class="postdes">獎項</div><div class="btn">功能</div></div><ul class="paper awarditem" num="1"></ul></div>');for(j in L.newPaperdata[i].list)$(".gamebox").eq(i).find(".paper").eq(1).append('<li><div class="posttitle">'+L.newPaperdata[i].list[j].name+'</div><div class="postdes">'+L.newPaperdata[i].list[j].word+'</div><div class="btn" gamenum="'+i+'" item="'+j+'"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>')}p()}function p(){$(".paper.awardspapertitle .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),m(!1,$(this).parent().parent().parent().parent().attr("gamenum"))):f($(this).parent().parent().parent().parent().attr("gamenum"))}),$(".paper.awardspapertitle .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),u($(this).parent().parent().parent().parent().attr("gamenum"))):($(this).addClass("on"),m(!0,$(this).parent().parent().parent().parent().attr("gamenum")))}),$(".new .gobtn").click(function(){c($(this).attr("gamenum"))}),$(".paper.awarditem .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),d(!1,$(this).parent().attr("gamenum"),$(this).parent().attr("item"))):o($(this).parent().attr("gamenum"),$(this).parent().attr("item"))}),$(".paper.awarditem .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),l($(this).parent().attr("gamenum"),$(this).parent().attr("item"))):($(this).addClass("on"),d(!0,$(this).parent().attr("gamenum"),$(this).parent().attr("item")))}),$(".menuin a").removeClass("on").eq(4).addClass("on"),N(!1)}function o(a,e){N(!0),L.newPaperdata[a].list.splice(e,1),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/awards"+L.nowpage+"/"+L.newPaperdata[a]._id.$oid+"?apiKey="+L.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(L.newPaperdata[a]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}function l(a,e){N(!0),L.newPaperdata[a].list[e].name=$(".gamebox").eq(a).find(".paper.awarditem li").eq(e).find(".posttitle textarea").val().replace(/\n\r?/g,"<br>"),L.newPaperdata[a].list[e].word=$(".gamebox").eq(a).find(".paper.awarditem li").eq(e).find(".postdes textarea").val().replace(/\n\r?/g,"<br>"),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/awards"+L.nowpage+"/"+L.newPaperdata[a]._id.$oid+"?apiKey="+L.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(L.newPaperdata[a]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}function d(a,e,t){a?($(".gamebox").eq(e).find(".paper.awarditem li").eq(t).find(".posttitle").html("<textarea>"+$(".gamebox").eq(e).find(".paper.awarditem li").eq(t).find(".posttitle").html().replace(/<br>/g,"\n")+"</textarea>"),$(".gamebox").eq(e).find(".paper.awarditem li").eq(t).find(".postdes").html("<textarea>"+$(".gamebox").eq(e).find(".paper.awarditem li").eq(t).find(".postdes").html().replace(/<br>/g,"\n")+"</textarea>")):($(".gamebox").eq(e).find(".paper.awarditem li").eq(t).find(".posttitle").html(L.newPaperdata[e].list[t].name),$(".gamebox").eq(e).find(".paper.awarditem li").eq(t).find(".postdes").html(L.newPaperdata[e].list[t].word))}function c(a){N(!0),L.newPaperdata[a].list.push({name:$(".gamebox").eq(a).find(".new .username").val().replace(/\n\r?/g,"<br>"),word:$(".gamebox").eq(a).find(".new .userdes").val().replace(/\n\r?/g,"<br>")}),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/awards"+L.nowpage+"/"+L.newPaperdata[a]._id.$oid+"?apiKey="+L.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(L.newPaperdata[a]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}function m(a,e){a?$(".gamebox").eq(e).find(".paper.awardspapertitle").find(".posttitle").html("<textarea>"+$(".gamebox").eq(e).find(".paper.awardspapertitle").find(".posttitle").html().replace(/<br>/g,"\n")+"</textarea>"):$(".gamebox").eq(e).find(".paper.awardspapertitle").find(".posttitle").html(L.newPaperdata[e].title)}function u(a){N(!0),L.newPaperdata[a].title=$(".gamebox").eq(a).find(".paper.awardspapertitle").find(".posttitle textarea").val().replace(/\n\r?/g,"<br>"),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/awards"+L.nowpage+"/"+L.newPaperdata[a]._id.$oid+"?apiKey="+L.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(L.newPaperdata[a]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}function f(a){N(!0),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/awards"+L.nowpage+"/"+L.newPaperdata[a]._id.$oid+"?apiKey="+L.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}function h(){if(L.learnload+=1,!(L.learnload<2)){for(var a=0;a<L.learndata.length;a++)if("learning_page"==L.learndata[a].collectname)$(".paper").eq(0).append('<li><div class="postphoto"><img src="'+L.learndata[a][0].photo+'"></div><div class="posttitle">'+L.learndata[a][0].classinfo+'</div><div class="postdes">'+L.learndata[a][0].classdes+'</div><div class="postid">　</div><div class="btn"><div title="修改" class="motify"></div></div></li>');else if("learning_photo_page"==L.learndata[a].collectname)for(var e=0;e<L.learndata[a].length;e++)$(".paper").eq(1).append('<li><div class="postphoto"><img src="'+L.learndata[a][e].pic+'"></div><div class="btn"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>');g()}}function g(){$(".paper .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),_(!1,$(this).parent().parent().index(),$(this).parent().parent().parent().attr("num"))):P($(this).parent().parent().index(),$(this).parent().parent().parent().attr("num"))}),$(".paper .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),x($(this).parent().parent().index(),$(this).parent().parent().parent().attr("num"))):($(this).addClass("on"),_(!0,$(this).parent().parent().index(),$(this).parent().parent().parent().attr("num")))}),$(".menuin a").removeClass("on").eq(3).addClass("on"),N(!1)}function w(a){$(".paper").html("");for(i in L.newPaperdata)L.newPaperdata[i].bpic||(L.newPaperdata[i].bpic="images/space.png"),L.newPaperdata[i].spic||(L.newPaperdata[i].spic="images/space.png"),$(".paper").append('<li><div class="newsbpic"><img src="'+L.newPaperdata[i].bpic+'"></div><div class="newsspic"><img src="'+L.newPaperdata[i].spic+'"></div><div class="newstitle">'+L.newPaperdata[i].title+'</div><div class="newssword">'+L.newPaperdata[i].sword+'</div><div class="newsbword">'+L.newPaperdata[i].bword+'</div><div class="btn"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>');b()}function b(){$(".paper .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),_(!1,$(this).parent().parent().index())):P($(this).parent().parent().index())}),$(".paper .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),x($(this).parent().parent().index())):($(this).addClass("on"),_(!0,$(this).parent().parent().index()))}),$(".menuin a").removeClass("on").eq(2).addClass("on"),N(!1)}function v(a){$(".paper").html("");for(i in L.newPaperdata){var e;e=L.newPaperdata[i].cover?'<img src="'+L.newPaperdata[i].cover+'">':'<img src="images/space.png">',$(".paper").eq(0).append('<li><div class="postphoto">'+e+'</div><div class="posttitle">'+L.newPaperdata[i].title+'</div><div class="postdes">'+L.newPaperdata[i].info+'</div><div class="postid">　</div><div class="btn"><div title="修改" class="motify"></div></div></li>')}for(i in L.newPaperdata[0].list){var e;e=L.newPaperdata[0].list[i].pic?'<img src="'+L.newPaperdata[0].list[i].pic+'">':'<img src="images/space.png">',$(".paper").eq(1).append('<li><div class="postphoto">'+e+'</div><div class="posttitle">'+L.newPaperdata[0].list[i].name+'</div><div class="postdes">'+L.newPaperdata[0].list[i].des+'</div><div class="postid">　</div><div class="btn"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>')}y()}function y(){$(".paper .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),_(!1,$(this).parent().parent().index(),$(this).parent().parent().parent().attr("num"))):P($(this).parent().parent().index(),$(this).parent().parent().parent().attr("num"))}),$(".paper .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),x($(this).parent().parent().index(),$(this).parent().parent().parent().attr("num"))):($(this).addClass("on"),_(!0,$(this).parent().parent().index(),$(this).parent().parent().parent().attr("num")))}),$(".menuin a").removeClass("on").eq(1).addClass("on"),N(!1)}function _(a,e,t){if(L.wrp.hasClass("about")){var n=$(".paper").eq(t).find("li").eq(e);a?(n.find(".posttitle").html("<textarea>"+n.find(".posttitle").html().replace(/<br>/g,"\n")+"</textarea>"),n.find(".postdes").html("<textarea>"+n.find(".postdes").html().replace(/<br>/g,"\n")+"</textarea>"),n.find(".postphoto").prepend('<input type="file" name="file" id="imgInputMotify" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify"><span>點擊更換</span></label>'),$("#imgInputMotify").change(function(){q(this,$(this))})):(n.find(".posttitle").html(n.find(".posttitle textarea").val().replace(/\n\r?/g,"<br>")),n.find(".postdes").html(n.find(".postdes textarea").val().replace(/\n\r?/g,"<br>")),n.find(".postphoto").html('<img src="'+L.newPaperdata[0].list[e].pic+'">'))}else if(L.wrp.hasClass("news")){var n=$(".paper").find("li").eq(e);a?(n.find(".newstitle").html("<textarea>"+n.find(".newstitle").html().replace(/<br>/g,"\n")+"</textarea>"),n.find(".newsbword").html("<textarea>"+n.find(".newsbword").html().replace(/<br>/g,"\n")+"</textarea>"),n.find(".newssword").html("<textarea>"+n.find(".newssword").html().replace(/<br>/g,"\n")+"</textarea>"),n.find(".newsbpic").prepend('<input type="file" name="file" id="imgInputMotify" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify"><span>點擊更換</span></label>'),$("#imgInputMotify").change(function(){q(this,$(this),0)}),n.find(".newsspic").prepend('<input type="file" name="file" id="imgInputMotify2" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify2"><span>點擊更換</span></label>'),$("#imgInputMotify2").change(function(){q(this,$(this),1)})):(n.find(".newstitle").html(n.find(".newstitle textarea").val().replace(/\n\r?/g,"<br>")),n.find(".newsbword").html(n.find(".newsbword textarea").val().replace(/\n\r?/g,"<br>")),n.find(".newssword").html(n.find(".newssword textarea").val().replace(/\n\r?/g,"<br>")),n.find(".newsbpic").html('<img src="'+L.newPaperdata[e].bpic+'">'),n.find(".newsspic").html('<img src="'+L.newPaperdata[e].spic+'">'))}else if(L.wrp.hasClass("learn")){var n=$(".paper").eq(t).find("li").eq(e);a?(0==t&&(n.find(".posttitle").html("<textarea>"+n.find(".posttitle").html().replace(/<br>/g,"\n")+"</textarea>"),n.find(".postdes").html("<textarea>"+n.find(".postdes").html().replace(/<br>/g,"\n")+"</textarea>")),n.find(".postphoto").prepend('<input type="file" name="file" id="imgInputMotify" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify"><span>點擊更換</span></label>'),$("#imgInputMotify").change(function(){q(this,$(this))})):n.find(".postphoto").html('<img src="'+L.learndata[1][e].pic+'">')}else if(L.wrp.hasClass("link")){var n=$(".paper li").eq(e);a?(n.find(".posttitle").html("<textarea>"+n.find(".posttitle a").html()+"</textarea>"),n.find(".postphoto").prepend('<input type="file" name="file" id="imgInputMotify" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify"><span>點擊更換</span></label>'),$("#imgInputMotify").change(function(){q(this,$(this))})):(n.find(".posttitle").html('<a href="'+L.newPaperdata[e].link+'">'+L.newPaperdata[e].link+"</a>"),n.find(".postphoto").html('<img src="'+L.newPaperdata[e].pic+'">'))}else L.wrp.hasClass("contact")&&(a?$(".paper_addr li").eq(e).find(".posttitle").html("<textarea>"+$(".paper_addr li").eq(e).find(".posttitle").html().replace(/<br>/g,"\n")+"</textarea>"):$(".paper_addr li").eq(e).find(".posttitle").html(L.learndata[t][e].addr))}function x(a,e){N(!0),L.wrp.hasClass("about")?(L._n=a,L._num=e,$(".paper").eq(e).find("li").eq(a).find(".postphoto").find("img").hasClass("on")?U(L.uploadImg,C):(L.uploadImgTrue=$(".paper").eq(e).find("li").eq(a).find(".postphoto").find("img").attr("src"),C())):L.wrp.hasClass("news")?(L._n=a,L.newspiccheck=0,$(".paper").find("li").eq(a).find(".newsbpic").find("img").hasClass("on")?U(L.uploadImgbpic,C,0):(L.newspiccheck+=1,L.uploadImgbpic=$(".paper").find("li").eq(a).find(".newsbpic").find("img").attr("src")),$(".paper").find("li").eq(a).find(".newsspic").find("img").hasClass("on")?U(L.uploadImgspic,C,1):(L.newspiccheck+=1,L.uploadImgspic=$(".paper").find("li").eq(a).find(".newsspic").find("img").attr("src")),C()):L.wrp.hasClass("learn")?(L._n=a,L._num=e,$(".paper").eq(e).find("li").eq(a).find(".postphoto").find("img").hasClass("on")?U(L.uploadImg,C):(L.uploadImgTrue=$(".paper").eq(e).find("li").eq(a).find(".postphoto").find("img").attr("src"),C())):L.wrp.hasClass("link")?(L._n=a,$(".paper li").eq(a).find(".postphoto").find("img").hasClass("on")?U(L.uploadImg,C):(L.uploadImgTrue=$(".paper li").eq(a).find(".postphoto").find("img").attr("src"),C())):L.wrp.hasClass("contact")&&(L._n=a,L._num=e,C())}function C(){if(L.wrp.hasClass("about"))0==L._num?(L.newPaperdata[0].title=$(".paper").eq(L._num).find("li").eq(L._n).find(".posttitle").find("textarea").val().replace(/\n\r?/g,"<br>"),L.newPaperdata[0].info=$(".paper").eq(L._num).find("li").eq(L._n).find(".postdes").find("textarea").val().replace(/\n\r?/g,"<br>"),L.newPaperdata[0].cover=L.uploadImgTrue):1==L._num&&(L.newPaperdata[0].list[L._n].name=$(".paper").eq(L._num).find("li").eq(L._n).find(".posttitle").find("textarea").val().replace(/\n\r?/g,"<br>"),L.newPaperdata[0].list[L._n].des=$(".paper").eq(L._num).find("li").eq(L._n).find(".postdes").find("textarea").val().replace(/\n\r?/g,"<br>"),L.newPaperdata[0].list[L._n].pic=L.uploadImgTrue),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/aboutus_page"+L.nowpage+"?apiKey="+L.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(L.newPaperdata),success:function(a){K("aboutus_page",v)},error:function(a,e,t){console.log("error:",a,e,t)}});else if(L.wrp.hasClass("news")){if(L.newspiccheck<2)return;L.newPaperdata[L._n].title=$(".paper").find("li").eq(L._n).find(".newstitle").find("textarea").val().replace(/\n\r?/g,"<br>"),L.newPaperdata[L._n].spic=L.uploadImgspic,L.newPaperdata[L._n].bpic=L.uploadImgbpic,L.newPaperdata[L._n].date=(new Date).getFullYear()+"/"+(1*(new Date).getMonth()+1)+"/"+(new Date).getDate()+"星期"+S((new Date).getDay()),L.newPaperdata[L._n].sword=$(".paper").find("li").eq(L._n).find(".newssword").find("textarea").val().replace(/\n\r?/g,"<br>"),L.newPaperdata[L._n].bword=$(".paper").find("li").eq(L._n).find(".newsbword").find("textarea").val().replace(/\n\r?/g,"<br>"),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/news_page"+L.nowpage+"/"+L.newPaperdata[L._n]._id.$oid+"?apiKey="+L.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(L.newPaperdata[L._n]),success:function(a){K("news_page",w)},error:function(a,e,t){console.log("error:",a,e,t)}})}else if(L.wrp.hasClass("learn"))0==L._num?(L.learndata[0][0].classinfo=$(".paper").eq(L._num).find("li").eq(L._n).find(".posttitle").find("textarea").val().replace(/\n\r?/g,"<br>"),L.learndata[0][0].classdes=$(".paper").eq(L._num).find("li").eq(L._n).find(".postdes").find("textarea").val().replace(/\n\r?/g,"<br>"),L.learndata[0][0].photo=L.uploadImgTrue,L.learndata[0][0].title=L.learndata[0][0].title,console.log(L.learndata[0][0].title),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/learning_page"+L.nowpage+"?apiKey="+L.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(L.learndata[0]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})):1==L._num&&(L.learndata[1][L._n].pic=L.uploadImgTrue,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/learning_photo_page"+L.nowpage+"?apiKey="+L.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(L.learndata[1]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}}));else if(L.wrp.hasClass("link"))L.newPaperdata[L._n].link=$(".paper li").eq(L._n).find(".posttitle textarea").val(),L.newPaperdata[L._n].pic=L.uploadImgTrue,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/otherlink"+L.nowpage+"/"+L.newPaperdata[L._n]._id.$oid+"?apiKey="+L.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(L.newPaperdata[L._n]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}});else if(L.wrp.hasClass("contact")){if(L.learndata[L._num][L._n].addr=$(".paper_addr li").eq(L._n).find(".posttitle textarea").val(),!L.learndata[L._num][L._n].addr)return void alert(L.creatUsererrortxt);$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/contactus"+L.nowpage+"/"+L.learndata[L._num][L._n]._id.$oid+"?apiKey="+L.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(L.learndata[L._num][L._n]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}}function P(a,e){N(!0),L.wrp.hasClass("about")?(L.newPaperdata[0].list.splice(a,1),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/aboutus_page"+L.nowpage+"?apiKey="+L.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(L.newPaperdata),success:function(a){K("aboutus_page",v)},error:function(a,e,t){console.log("error:",a,e,t)}})):L.wrp.hasClass("news")?$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/news_page"+L.nowpage+"/"+L.newPaperdata[a]._id.$oid+"?apiKey="+L.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){K("news_page",w)},error:function(a,e,t){console.log("error:",a,e,t)}}):L.wrp.hasClass("learn")?$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/learning_photo_page"+L.nowpage+"/"+L.learndata[e][a]._id.$oid+"?apiKey="+L.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}}):L.wrp.hasClass("link")?$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/otherlink"+L.nowpage+"/"+L.newPaperdata[a]._id.$oid+"?apiKey="+L.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}}):L.wrp.hasClass("contact")&&$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/emailbox"+L.nowpage+"/"+L.learndata[e][a]._id.$oid+"?apiKey="+L.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}function k(a,e,t){if(a.files&&a.files[0]){var n=new FileReader;n.onload=function(a){0==t?L.newsuploadImgbpic=a.target.result.replace(/.*,/,""):L.newsuploadImgspic=a.target.result.replace(/.*,/,""),e.parent().addClass("on").find("img").addClass("on").attr("src",a.target.result)},n.readAsDataURL(a.files[0])}}function q(a,e,t){if(L.wrp.hasClass("about")||L.wrp.hasClass("learn")||L.wrp.hasClass("link")){if(a.files&&a.files[0]){var n=new FileReader;n.onload=function(a){L.uploadImg=a.target.result.replace(/.*,/,""),e.parent().addClass("on").find("img").addClass("on").attr("src",a.target.result)},n.readAsDataURL(a.files[0])}}else if(L.wrp.hasClass("news")&&a.files&&a.files[0]){var n=new FileReader;n.onload=function(a){0==t?L.uploadImgbpic=a.target.result.replace(/.*,/,""):L.uploadImgspic=a.target.result.replace(/.*,/,""),e.parent().addClass("on").find("img").addClass("on").attr("src",a.target.result)},n.readAsDataURL(a.files[0])}}function I(){if(L.wrp.hasClass("about")){if(L.posttitleval=$(".new .posttitle").val(),L.postdesval=$(".new .postdes").val(),!L.posttitleval||!L.postdesval)return void alert(L.creatUsererrortxt);N(!0),L.uploadImg?U(L.uploadImg,T):T()}else if(L.wrp.hasClass("news")){if(L.insertdata={title:$(".new .newstitle").val().replace(/\n\r?/g,"<br>"),date:(new Date).getFullYear()+"/"+(1*(new Date).getMonth()+1)+"/"+(new Date).getDate()+"星期"+S((new Date).getDay()),sword:$(".new .newssword").val().replace(/\n\r?/g,"<br>"),bword:$(".new .newsbword").val().replace(/\n\r?/g,"<br>")},!L.insertdata.title||!L.insertdata.sword||!L.insertdata.bword)return void alert(L.creatUsererrortxt);N(!0),L.newsinsertpiccheck=0,L.newsuploadImgbpic?A(L.newsuploadImgbpic,T,0):(L.newsinsertpiccheck+=1,L.newsuploadImgbpic="images/space.png"),L.newsuploadImgspic?A(L.newsuploadImgspic,T,1):(L.newsinsertpiccheck+=1,L.newsuploadImgspic="images/space.png"),T()}else if(L.wrp.hasClass("learn"))N(!0),L.uploadImg?U(L.uploadImg,T):alert(L.creatUsererrortxt);else if(L.wrp.hasClass("link")){if(N(!0),L.insertdata={link:$(".new .posttitle").val()},!L.insertdata.link)return void alert(L.creatUsererrortxt);L.uploadImg?U(L.uploadImg,T):alert(L.creatUsererrortxt)}}function T(){if(L.wrp.hasClass("about"))L.newPaperdata[0].list.push({name:L.posttitleval.replace(/\n\r?/g,"<br>"),des:L.postdesval.replace(/\n\r?/g,"<br>"),pic:L.uploadImgTrue}),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/aboutus_page"+L.nowpage+"?apiKey="+L.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(L.newPaperdata),success:function(a){J(),K("aboutus_page",v)},error:function(a,e,t){console.log("error:",a,e,t)}});else if(L.wrp.hasClass("news")){if(L.newsinsertpiccheck<2)return;L.insertdata.bpic=L.newsuploadImgbpic,L.insertdata.spic=L.newsuploadImgspic,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/news_page"+L.nowpage+"?apiKey="+L.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(L.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}else L.wrp.hasClass("learn")?(L.insertdata={pic:L.uploadImgTrue},$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/learning_photo_page"+L.nowpage+"?apiKey="+L.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(L.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})):L.wrp.hasClass("link")&&(L.insertdata.pic=L.uploadImgTrue,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/otherlink"+L.nowpage+"?apiKey="+L.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(L.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}}))}function A(a,e,t){$.ajax({url:"https://api.imgur.com/3/image",method:"POST",headers:{Authorization:"Bearer "+L.imgurToken,Accept:"application/json"},data:{image:a,type:"base64"},success:function(a){L.wrp.hasClass("news")&&(L.newsinsertpiccheck+=1,0==t?L.newsuploadImgbpic=a.data.link:L.newsuploadImgspic=a.data.link),e()},error:function(a,e,t){console.log("error:",a,e,t),window.location.href="https://api.imgur.com/oauth2/authorize?response_type=token&client_id="+L.imgurappid}})}function U(a,e,t){$.ajax({url:"https://api.imgur.com/3/image",method:"POST",headers:{Authorization:"Bearer "+L.imgurToken,Accept:"application/json"},data:{image:a,type:"base64"},success:function(a){(L.wrp.hasClass("about")||L.wrp.hasClass("learn")||L.wrp.hasClass("link"))&&(L.uploadImgTrue=a.data.link),L.wrp.hasClass("news")&&(L.newspiccheck+=1,0==t?L.uploadImgbpic=a.data.link:L.uploadImgspic=a.data.link),e()},error:function(a,e,t){console.log("error:",a,e,t),window.location.href="https://api.imgur.com/oauth2/authorize?response_type=token&client_id="+L.imgurappid}})}function K(a,e){$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/"+a+L.nowpage+'?s={"_id":-1}&apiKey='+L.mlabApikey,type:"GET",contentType:"application/json",success:function(a){L.newPaperdata=a,e(a)},error:function(a,e,t){console.log("error:",a,e,t)}})}function O(a,e){$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/"+a+L.nowpage+'?s={"_id":-1}&apiKey='+L.mlabApikey,type:"GET",contentType:"application/json",success:function(t){L.learndata.push(t),L.learndata[L.learndata.length-1].collectname=a,e()},error:function(a,e,t){console.log("error:",a,e,t)}})}function S(a){return 0==a?a="日":1==a?a="一":2==a?a="二":3==a?a="三":4==a?a="四":5==a?a="五":6==a&&(a="六"),a}function M(a){window.location.href=a.attr("gopage")+"#access_token="+window.location.href.split("#access_token=")[1]}function D(){$.cookie("useraccount",""),$.cookie("userpassword",""),window.location.href="index.html"}function E(){var a=!1;return $.cookie("useraccount")&&$.cookie("userpassword")&&(a=!0),a}function J(){L.posttitleval="",L.nowtime="",L.postdesval="",L.uploadImg="",L.uploadImgTrue="",$(".new .posttitle").val(""),$(".new .postdes").val(""),$(".new .addImg").removeClass("on").find("img").attr("src","")}function N(a){a?$(".loading").fadeIn():($(".loading").hasClass("on")||$(".loading").addClass("on"),$(".loading").fadeOut())}var L={};L.wrp=$(".wrapper"),L.mlabApikey="n6FXodWWCdM14KrePZHrRPPovbzboRn6",L.imgurappid="752b0363900112d",L.creatUsererrortxt="請填寫完整資料";try{L.nowpage=getUrlVars().page.replace("#access_token","")}catch(R){L.nowpage=1}$(".sec_menu").length>0&&($(".sec_menu a").eq(L.nowpage-1).addClass("on"),$(".title").eq(0).html($(".sec_menu a").eq(L.nowpage-1).text())),L.wrp.hasClass("about")?K("aboutus_page",v):L.wrp.hasClass("news")?K("news_page",w):L.wrp.hasClass("learn")?(L.learnload=0,L.learndata=[],O("learning_page",h),O("learning_photo_page",h)):L.wrp.hasClass("awards")?K("awards",r):L.wrp.hasClass("link")?K("otherlink",t):L.wrp.hasClass("contact")?(L.contactload=0,L.learndata=[],O("contactus",a),O("emailbox",a)):N(!1),$(".gogamebtn").click(function(){s()}),$(".menua").click(function(){M($(this))}),$("#imgInput").change(function(){q(this,$(this))}),$("#newsimgInput").change(function(){k(this,$(this),0)}),$("#newsimgInput2").change(function(){k(this,$(this),1)}),$(".userMenu .logoutbtn").click(function(){D()}),$(".new .gobtn").click(function(){I()}),$(window).load(function(){if(E())try{L.imgurToken=window.location.href.split("#")[1].split("&")[0].replace("access_token=",""),$(".userMenu .icon").html($.cookie("useraccount").substring(0,1)),$(".userMenu .name").html($.cookie("username"))}catch(a){window.location.href="https://api.imgur.com/oauth2/authorize?response_type=token&client_id="+L.imgurappid}else window.location.href="index.html"+window.location.hash})});