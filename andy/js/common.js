$(document).ready(function(){function e(){$.cookie("useraccount",""),$.cookie("userpassword",""),location.reload()}function n(){var e='https://api.mlab.com/api/1/databases/chinesechess2016/collections/user?q={useraccount:"'+$(".login_page .signaccount").val()+'"}&apiKey='+_.mlabApikey;m(!0),$.ajax({url:e,type:"GET",contentType:"application/json",success:function(e){_.issignup=e,a()},error:function(e,n,i){console.log("error:",e,n,i)}})}function a(){if(""==_.issignup){if(!($(".login_page_sign .signname").val()&&$(".login_page_sign .signpassword").val()&&$(".login_page_sign .signaccount").val()&&$(".login_page_sign .signemail").val()))return alert(_.creatUsererrortxt),void m(!1);$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/user?apiKey="+_.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify({username:$(".login_page_sign .signname").val(),userpassword:$(".login_page_sign .signpassword").val(),useraccount:$(".login_page_sign .signaccount").val(),useremail:$(".login_page_sign .signemail").val()}),success:function(e){m(!1),$(".msg").fadeIn(),setTimeout(function(){$(".msg").fadeOut()},5e3),f(),t(!1)},error:function(e,n,i){console.log("error:",e,n,i)}})}else m(!1),alert(_.signerrortxt)}function t(e){e?$(".login_pagein").addClass("on"):$(".login_pagein").removeClass("on")}function o(e,n){var i='https://api.mlab.com/api/1/databases/chinesechess2016/collections/user?q={useraccount:"'+e+'",userpassword:"'+n+'"}&apiKey='+_.mlabApikey;m(!0),$.ajax({url:i,type:"GET",contentType:"application/json",success:function(e){_.islogin=e,f(),s()},error:function(e,n,i){console.log("error:",e,n,i)}})}function s(){""!=_.islogin?(v(!1),u(),$(".userMenu .icon").html(_.islogin[0].useraccount.substring(0,1)),$(".userMenu .name").html(_.islogin[0].username),$.cookie("useraccount",_.islogin[0].useraccount),$.cookie("userpassword",_.islogin[0].userpassword)):(m(!1),alert(_.loginerrortxt))}function l(){var e=!1;return $.cookie("useraccount")&&$.cookie("userpassword")&&(e=!0),e}function p(e){$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/paperid/"+_.newPaperdata[e]._id.$oid+"?apiKey="+_.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(e){u()},error:function(e,n,i){console.log("error:",e,n,i)}})}function c(e){$(".paper li").eq(e).find(".posttitle").html("<textarea>"+$(".paper li").eq(e).find(".posttitle").text()+"</textarea>"),$(".paper li").eq(e).find(".postdes").html("<textarea>"+$(".paper li").eq(e).find(".postdes").text()+"</textarea>")}function r(e){m(!0),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/paperid/"+_.newPaperdata[e]._id.$oid+"?apiKey="+_.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify({postdate:new Date,postdes:$(".paper li").eq(e).find(".postdes").find("textarea").val(),postid:_.newPaperdata[e].postid,posttitle:$(".paper li").eq(e).find(".posttitle").find("textarea").val()}),success:function(e){u()},error:function(e,n,i){console.log("error:",e,n,i)}})}function u(){$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/paperid?apiKey="+_.mlabApikey,type:"GET",contentType:"application/json",success:function(e){_.newPaperdata=e,d()},error:function(e,n,i){console.log("error:",e,n,i)}})}function d(){$(".paper").html("");for(i in _.newPaperdata)$(".paper").append('<li><div class="postid">'+_.newPaperdata[i].postdate+'</div><div class="posttitle">'+_.newPaperdata[i].posttitle+'</div><div class="postdes">'+_.newPaperdata[i].postdes+'</div><div class="btn"><div class="motify"></div><div class="delbtn"></div></div></li>');$(".paper .delbtn").click(function(){p($(this).parent().parent().index())}),$(".paper .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),r($(this).parent().parent().index())):($(this).addClass("on"),c($(this).parent().parent().index()))}),m(!1)}function g(){return _.nowtime=new Date,_.posttitleval=$(".new .posttitle").val(),_.postdesval=$(".new .postdes").val(),_.posttitleval&&_.nowtime&&_.postdesval?(m(!0),void $.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/paperid?apiKey="+_.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify({postdate:_.nowtime,postdes:_.postdesval,postid:"0000",posttitle:_.posttitleval}),success:function(e){f(),u()},error:function(e,n,i){console.log("error:",e,n,i)}})):void alert("請填寫資料內容")}function f(){_.posttitleval="",_.nowtime="",_.postdesval="",$(".new .posttitle").val(""),$(".new .postdes").val(""),$(".login_page_sign .signname").val(""),$(".login_page_sign .signpassword").val(""),$(".login_page_sign .signaccount").val(""),$(".login_page_sign .signemail").val(""),$(".login_pagein").find("input").val("")}function v(e){e?$(".login_page").fadeIn():$(".login_page").fadeOut()}function m(e){e?$(".loading").fadeIn():($(".loading").hasClass("on")||$(".loading").addClass("on"),$(".loading").fadeOut())}var _={};_.mlabApikey="n6FXodWWCdM14KrePZHrRPPovbzboRn6",_.loginerrortxt="帳號或密碼錯誤，請重新輸入",_.signerrortxt="此帳號有人註冊過，請換一個帳號",_.creatUsererrortxt="請填寫完整資料",$(".userMenu .logoutbtn").click(function(){e()}),$(".login_pagein .submitbtn").click(function(){n()}),$(".login_pagein .cancelbtn").click(function(){t(!1)}),$(".login_pagein .singupbtn").click(function(){t(!0)}),$(".login_pagein .surebtn").click(function(){o($(".login_page .useraccount").val(),$(".login_page .userpassword").val())}),$(".andy_test .new .gobtn").click(function(){g()}),$(window).load(function(){l()?o($.cookie("useraccount"),$.cookie("userpassword")):m(!1)})});