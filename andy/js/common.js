$(document).ready(function(){function e(){$(".login_pagein").find("input").val("")}function t(){var t='https://api.mlab.com/api/1/databases/chinesechess2016/collections/user?q={useraccount:"'+$(".login_page .useraccount").val()+'",userpassword:"'+$(".login_page .userpassword").val()+'"}&apiKey='+f.mlabApikey;u(!0),$.ajax({url:t,type:"GET",contentType:"application/json",success:function(t){console.log(t),f.islogin=t,a(),e()},error:function(e,t,a){console.log("error:",e,t,a)}})}function a(){""!=f.islogin?(d(!1),p()):(u(!1),alert(f.loginerrortxt))}function n(e){$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/paperid/"+f.newPaperdata[e]._id.$oid+"?apiKey="+f.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(e){p()},error:function(e,t,a){console.log("error:",e,t,a)}})}function o(e){$(".paper li").eq(e).find(".posttitle").html("<textarea>"+$(".paper li").eq(e).find(".posttitle").text()+"</textarea>"),$(".paper li").eq(e).find(".postdes").html("<textarea>"+$(".paper li").eq(e).find(".postdes").text()+"</textarea>")}function s(e){u(!0),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/paperid/"+f.newPaperdata[e]._id.$oid+"?apiKey="+f.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify({postdate:new Date,postdes:$(".paper li").eq(e).find(".postdes").find("textarea").val(),postid:f.newPaperdata[e].postid,posttitle:$(".paper li").eq(e).find(".posttitle").find("textarea").val()}),success:function(e){console.log(e),p()},error:function(e,t,a){console.log("error:",e,t,a)}})}function p(){$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/paperid?apiKey="+f.mlabApikey,type:"GET",contentType:"application/json",success:function(e){f.newPaperdata=e,l()},error:function(e,t,a){console.log("error:",e,t,a)}})}function l(){$(".paper").html("");for(i in f.newPaperdata)$(".paper").append('<li><div class="postid">'+f.newPaperdata[i].postdate+'</div><div class="posttitle">'+f.newPaperdata[i].posttitle+'</div><div class="postdes">'+f.newPaperdata[i].postdes+'</div><div class="btn"><div class="motify"></div><div class="delbtn"></div></div></li>');$(".paper .delbtn").click(function(){n($(this).parent().parent().index())}),$(".paper .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),s($(this).parent().parent().index())):($(this).addClass("on"),o($(this).parent().parent().index()))}),u(!1)}function c(){return f.nowtime=new Date,f.posttitleval=$(".new .posttitle").val(),f.postdesval=$(".new .postdes").val(),f.posttitleval&&f.nowtime&&f.postdesval?(u(!0),void $.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/paperid?apiKey="+f.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify({postdate:f.nowtime,postdes:f.postdesval,postid:"0000",posttitle:f.posttitleval}),success:function(e){r(),p()},error:function(e,t,a){console.log("error:",e,t,a)}})):void alert("請填寫資料內容")}function r(){f.posttitleval="",f.nowtime="",f.postdesval="",$(".new .posttitle").val(""),$(".new .postdes").val("")}function d(e){e?$(".login_page").fadeIn():$(".login_page").fadeOut()}function u(e){e?$(".loading").fadeIn():$(".loading").fadeOut()}var f={};f.mlabApikey="n6FXodWWCdM14KrePZHrRPPovbzboRn6",f.loginerrortxt="帳號或密碼錯誤，請重新輸入",$(".login_pagein .surebtn").click(function(){t()}),$(".gobtn").click(function(){c()}),$(window).load(function(){u(!1)})});